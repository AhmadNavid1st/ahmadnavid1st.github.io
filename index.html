<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AhmadNavid1st Messenger ‚Äî Ÿæ€åÿßŸÖ‚Äåÿ±ÿ≥ÿßŸÜ</title>
  <meta name="description" content="Messenger page for Ahmad Navid Ahmadi ‚Äî sends messages & files to Telegram bot." />

  <!-- Many color variables (24+). Use them across the UI. -->
  <style>
    :root{
      --c1:#0B6E4F; --c2:#0F9D58; --c3:#31A0B0; --c4:#4B77BE; --c5:#7B61FF;
      --c6:#B24DFF; --c7:#FF4DAA; --c8:#FF5E5B; --c9:#FF8A00; --c10:#FFC857;
      --c11:#FFD6A5; --c12:#FFE7C7; --c13:#DFF3E3; --c14:#C8E6C9; --c15:#A2D2FF;
      --c16:#9BE7FF; --c17:#F0E7FF; --c18:#FDE2FF; --c19:#E6FFFA; --c20:#F1F8E9;
      --c21:#E0F7FA; --c22:#F3E5F5; --c23:#FFE0B2; --c24:#D7CCC8; --bg-alpha:rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.06);
      --radius:14px;
      --shadow: 0 6px 24px rgba(0,0,0,0.28);
      font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: center/cover no-repeat url("photo.jpg");
      background-attachment: fixed;
    }

    /* subtle overlay */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: linear-gradient(135deg, rgba(11,110,79,0.18), rgba(11,109,190,0.12));
      pointer-events:none;
    }

    /* Outer container */
    .app {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px;
      box-sizing:border-box;
      gap:24px;
    }

    /* Messenger card */
    .card {
      width:min(1100px, 98%);
      height:min(820px, 92vh);
      display:grid;
      grid-template-columns: 360px 1fr;
      border-radius:18px;
      overflow:hidden;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    }

    /* left language / contacts */
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      border-right:1px solid rgba(255,255,255,0.03);
    }

    .brand {
      display:flex; align-items:center; gap:12px;
    }
    .brand .logo{
      display:grid; place-items:center;
      width:58px; height:58px; border-radius:12px;
      background: linear-gradient(135deg,var(--c5),var(--c6));
      color:white; font-weight:700; font-size:20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.32);
    }
    .brand h1{ margin:0; font-size:16px; color:#fff; }
    .brand p{ margin:0; font-size:12px; color:rgba(255,255,255,0.78) }

    .lang-toggle {
      display:flex; gap:8px; margin-left:auto;
    }
    .lang-toggle button {
      border: none; padding:8px 10px; border-radius:10px;
      background: transparent; color:white; cursor:pointer;
      font-weight:600; opacity:0.9;
    }
    .lang-toggle button.active{
      background: linear-gradient(90deg,var(--c2),var(--c3));
      box-shadow: 0 6px 18px rgba(11,110,79,0.18);
    }

    .contact-list { overflow:auto; padding-right:6px; margin-top:12px; }
    .contact {
      display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px;
      cursor:pointer; transition: all .18s; color:rgba(255,255,255,0.95);
    }
    .contact:hover{ transform:translateX(6px); background: rgba(255,255,255,0.02); }
    .contact .avatar { width:44px; height:44px; border-radius:8px; background:var(--c11); display:grid; place-items:center; font-weight:700; color:#222; }
    .contact small { display:block; font-size:12px; color:rgba(255,255,255,0.66); }

    /* Main chat area */
    .chat {
      display:flex; flex-direction:column; gap:12px; padding:18px;
    }
    .chat-header {
      display:flex; align-items:center; gap:12px; justify-content:space-between;
      color:white;
    }
    .chat-window{
      flex:1; overflow:auto; padding:14px; border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px dashed rgba(255,255,255,0.02);
    }

    /* messages */
    .msg { display:flex; gap:12px; margin-bottom:12px; max-width:80%; }
    .msg.me { margin-left:auto; flex-direction:row-reverse; }
    .bubble {
      padding:12px 14px; border-radius:14px; line-height:1.35;
      background: linear-gradient(180deg,var(--c16),var(--c15));
      color:#012; box-shadow: 0 6px 20px rgba(0,0,0,0.18);
    }
    .bubble.meta { font-size:12px; color:rgba(0,0,0,0.6); background:var(--glass); color:#fff; border:1px solid rgba(255,255,255,0.04); }

    .send-area {
      display:flex; gap:12px; align-items:center; margin-top:8px;
      padding:10px; border-radius:12px; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }
    .send-area textarea { flex:1; min-height:48px; max-height:160px; resize:vertical;
      padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:white;
    }
    .controls { display:flex; gap:8px; align-items:center; }
    .btn {
      padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }
    .btn.primary { background: linear-gradient(90deg,var(--c2),var(--c3)); color:white; }
    .btn.soft { background: rgba(255,255,255,0.02); color:white; border:1px solid rgba(255,255,255,0.03); }

    .file-preview { display:flex; gap:8px; align-items:center; font-size:13px; color:rgba(255,255,255,0.85); }

    /* small responsive */
    @media (max-width:880px){
      .card { grid-template-columns: 1fr; height: 96vh; }
      .sidebar { order:2; height: auto; max-height:220px; overflow:auto; }
    }

    /* Decorative border and styling for "very beautiful" message box used in telegram messages (HTML) */
    .telegram-html-preview {
      padding:10px; border-radius:12px; background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(255,255,255,0.02));
      border-left:6px solid var(--c2);
      color:white; font-size:13px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" role="application" aria-label="Ahmad Navid Messenger">
      <div class="sidebar" aria-hidden="false">
        <div style="display:flex;align-items:center;">
          <div class="brand" style="width:100%;">
            <div class="logo">AN</div>
            <div>
              <h1>AhmadNavid Messenger</h1>
              <p>Secure Chat ‚Ä¢ Telegram Bridge</p>
            </div>

            <div class="lang-toggle" id="langToggle" style="margin-left:auto;">
              <button id="btnEN" class="active" title="English">EN</button>
              <button id="btnFA" title="ŸÅÿßÿ±ÿ≥€å">FA</button>
            </div>
          </div>
        </div>

        <div style="font-size:13px; color:rgba(255,255,255,0.9); margin-top:8px;">
          <strong id="meLabel">You</strong> ‚Ä¢ <small id="adminLabel">Admin: loading‚Ä¶</small>
        </div>

        <div class="contact-list" id="contacts">
          <!-- sample contact -->
          <div class="contact selected" data-id="admin">
            <div class="avatar">AN</div>
            <div>
              <div style="font-weight:700;">Admin</div>
              <small>Ahmad Navid ‚Äî Owner</small>
            </div>
          </div>

          <!-- add a few decorative presets with varied colors -->
          <div class="contact" style="margin-top:8px;">
            <div class="avatar" style="background:var(--c5)">TG</div>
            <div><div>Telegram Bot</div><small>Receive messages & files</small></div>
          </div>
        </div>

        <div style="margin-top:auto; font-size:13px; color:rgba(255,255,255,0.8);">
          <div style="display:flex; gap:8px; align-items:center;">
            <div style="flex:1;">Status: <span id="status">Ready</span></div>
            <button class="btn soft" onclick="openSupport()">
              <span id="supportBtnLabel">Support</span>
            </button>
          </div>
        </div>
      </div>

      <div class="chat" role="main">
        <div class="chat-header">
          <div>
            <div style="font-weight:800; font-size:18px;" id="chatTitle">Send to Admin</div>
            <div style="color:rgba(255,255,255,0.7); font-size:13px;" id="chatSubtitle">Your messages will be forwarded to Telegram</div>
          </div>

          <div style="display:flex; gap:8px; align-items:center;">
            <div style="text-align:right;">
              <div style="font-size:12px; color:rgba(255,255,255,0.7);">Design by</div>
              <div style="font-weight:700;">Ahmad Navid</div>
            </div>
          </div>
        </div>

        <div class="chat-window" id="chatWindow" aria-live="polite">
          <!-- sample messages -->
          <div class="msg">
            <div class="bubble meta">Welcome! ‚ú® Choose language at top-right ‚Ä¢ ÿ≤ÿ®ÿßŸÜ ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ</div>
          </div>

          <div id="messageFeed"></div>
        </div>

        <div class="send-area" role="region" aria-label="Send message">
          <textarea id="messageInput" placeholder="Write your message..."></textarea>

          <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end;">
            <div class="controls">
              <input id="fileInput" type="file" style="display:none" />
              <button class="btn soft" onclick="document.getElementById('fileInput').click()">üìé Attach</button>
              <button id="previewBtn" class="btn soft">üëÅ Preview</button>
              <button id="sendBtn" class="btn primary">‚úâÔ∏è Send</button>
            </div>

            <div class="file-preview" id="filePreview" style="display:none;">
              <span id="fileName"></span>
              <button class="btn soft" onclick="removeFile()">‚úñ</button>
            </div>
          </div>
        </div>

        <div style="margin-top:6px; color:rgba(255,255,255,0.75); font-size:12px;">
          <div class="telegram-html-preview" id="htmlPreview">
            Preview: The message you send will be formatted and forwarded to Telegram as <code>HTML</code>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- config.js is generated by the GitHub action from secrets -->
  <script src="config.js"></script>

  <script>
    // Default safe placeholders; config.js will override these if present.
    window.__TELEGRAM__ = window.__TELEGRAM__ || { TOKEN: '', ADMIN: '' };

    // UI strings (EN & FA)
    const STR = {
      en: {
        send: "Send",
        support: "Support",
        preview: "Preview",
        placeholder: "Write your message...",
        ready: "Ready",
        sending: "Sending...",
        sent: "Sent ‚úì",
        error: "Error sending ‚Äî check console",
        adminLabel: "Admin ID:",
      },
      fa: {
        send: "ÿßÿ±ÿ≥ÿßŸÑ",
        support: "Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å",
        preview: "Ÿæ€åÿ¥‚ÄåŸÜŸÖÿß€åÿ¥",
        placeholder: "Ÿæ€åÿßŸÖ ÿÆŸàÿØ ÿ±ÿß ÿ®ŸÜŸà€åÿ≥€åÿØ...",
        ready: "ÿ¢ŸÖÿßÿØŸá",
        sending: "ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...",
        sent: "ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ ‚úì",
        error: "ÿÆÿ∑ÿß ŸáŸÜ⁄ØÿßŸÖ ÿßÿ±ÿ≥ÿßŸÑ ‚Äî ⁄©ŸÜÿ≥ŸàŸÑ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ",
        adminLabel: "ÿ¥ŸÜÿßÿ≥Ÿá ÿßÿØŸÖ€åŸÜ:",
      }
    };

    let lang = 'en';
    const applyLang = () => {
      document.getElementById('btnEN').classList.toggle('active', lang === 'en');
      document.getElementById('btnFA').classList.toggle('active', lang === 'fa');
      document.getElementById('messageInput').placeholder = STR[lang].placeholder;
      document.getElementById('supportBtnLabel').innerText = STR[lang].support;
      document.getElementById('previewBtn').innerText = STR[lang].preview;
      document.getElementById('sendBtn').innerText = STR[lang].send;
      document.getElementById('status').innerText = STR[lang].ready;
      document.getElementById('meLabel').innerText = lang === 'en' ? 'You' : 'ÿ¥ŸÖÿß';
      document.getElementById('chatTitle').innerText = lang === 'en' ? 'Send to Admin' : 'ÿßÿ±ÿ≥ÿßŸÑ ÿ®Ÿá ÿßÿØŸÖ€åŸÜ';
      document.getElementById('chatSubtitle').innerText = lang === 'en' ? 'Your messages will be forwarded to Telegram' : 'Ÿæ€åÿßŸÖ‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®Ÿá ÿ™ŸÑ⁄Øÿ±ÿßŸÖ ŸÅÿ±ÿ≥ÿ™ÿßÿØŸá ÿÆŸàÿßŸáŸÜÿØ ÿ¥ÿØ';
      document.getElementById('adminLabel').innerText = STR[lang].adminLabel + " " + (window.__TELEGRAM__.ADMIN || '‚Äî');
    };

    document.getElementById('btnEN').addEventListener('click', () => { lang='en'; applyLang(); });
    document.getElementById('btnFA').addEventListener('click', () => { lang='fa'; applyLang(); });
    applyLang();

    // File attachment handlers
    let currentFile = null;
    document.getElementById('fileInput').addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return removeFile();
      currentFile = f;
      document.getElementById('filePreview').style.display = 'flex';
      document.getElementById('fileName').innerText = f.name + ' ‚Ä¢ ' + Math.round(f.size/1024) + ' KB';
    });
    function removeFile(){
      currentFile = null;
      document.getElementById('fileInput').value = '';
      document.getElementById('filePreview').style.display = 'none';
    }

    // small helper: get public IP (uses ipify.org)
    async function getPublicIP(){
      try{
        const r = await fetch('https://api.ipify.org?format=json');
        if(!r.ok) return 'unknown';
        const j = await r.json();
        return j.ip || 'unknown';
      }catch(e){
        return 'unknown';
      }
    }

    // build the HTML message to send to Telegram (parse_mode=HTML)
    async function buildTelegramHTML(name, text){
      const ua = navigator.userAgent || 'unknown';
      const platform = navigator.platform || 'unknown';
      const ip = await getPublicIP();
      const time = new Date().toLocaleString();

      // A "very beautiful" HTML block ‚Äî uses <b>, <i>, <code>, <a>
      const html = `
<b>üì® New message to Ahmad Navid</b>
<i>From:</i> ${escapeHtml(name)} 
<i>Time:</i> ${escapeHtml(time)}

<b>Message:</b>
${escapeHtml(text).replace(/\n/g,'\n')}

<b>Device info</b>
<i>UserAgent:</i> <code>${escapeHtml(ua)}</code>
<i>Platform:</i> ${escapeHtml(platform)}
<i>Public IP:</i> <code>${escapeHtml(ip)}</code>

<pre>‚Äî Sent via AhmadNavid1st.github.io</pre>
`;
      return html;
    }

    // simple html escape
    function escapeHtml(str){
      if(!str) return '';
      return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    // preview button
    document.getElementById('previewBtn').addEventListener('click', async ()=>{
      const name = 'Visitor';
      const text = document.getElementById('messageInput').value || '(empty)';
      const html = await buildTelegramHTML(name, text);
      document.getElementById('htmlPreview').innerText = html;
    });

    // send button
    document.getElementById('sendBtn').addEventListener('click', async ()=>{
      const sendBtn = document.getElementById('sendBtn');
      const status = document.getElementById('status');
      sendBtn.disabled = true;
      status.innerText = STR[lang].sending;

      const text = document.getElementById('messageInput').value || '(no text)';
      const html = await buildTelegramHTML('Website Visitor', text);

      // Prefer server-side forwarding (recommended). This implementation will attempt to call Telegram API directly.
      // WARNING: If config.js sets TOKEN to a real token and ADMIN to a user id, this will attempt to send directly.
      try{
        if(!window.__TELEGRAM__ || !window.__TELEGRAM__.TOKEN || !window.__TELEGRAM__.ADMIN){
          throw new Error('Missing TOKEN or ADMIN in config.js');
        }

        // Attempt to send file if attached
        if(currentFile){
          // sendDocument endpoint
          const form = new FormData();
          form.append('chat_id', window.__TELEGRAM__.ADMIN);
          form.append('caption', html);
          form.append('parse_mode', 'HTML');
          form.append('document', currentFile, currentFile.name);

          // NOTE: Telegram Bot API often blocks CORS requests from browsers. If you see a CORS error, use a server-side proxy.
          const resp = await fetch(`https://api.telegram.org/bot${window.__TELEGRAM__.TOKEN}/sendDocument`, {
            method: 'POST',
            body: form
          });
          const data = await resp.json();
          if(!data.ok) throw new Error('Telegram error: ' + JSON.stringify(data));
        } else {
          // sendMessage with HTML parse
          const payload = {
            chat_id: window.__TELEGRAM__.ADMIN,
            text: html,
            parse_mode: 'HTML',
            disable_web_page_preview: true
          };

          const resp = await fetch(`https://api.telegram.org/bot${window.__TELEGRAM__.TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify(payload)
          });

          const data = await resp.json();
          if(!data.ok) throw new Error('Telegram error: ' + JSON.stringify(data));
        }

        // success
        status.innerText = STR[lang].sent;
        addLocalMessage(text, true);
        document.getElementById('messageInput').value = '';
        removeFile();

      }catch(err){
        console.error(err);
        status.innerText = STR[lang].error;
        alert('‚ö†Ô∏è ' + (err.message || err));
        // If the direct API call fails due to CORS, show friendly instructions:
        if(err.message && err.message.includes('Failed to fetch')){
          alert('Note: The browser could not contact Telegram API directly (CORS issue). Use a server-side forwarder or deploy via the provided GitHub Action workflow that sends messages server-side.');
        }
      }finally{
        sendBtn.disabled = false;
        setTimeout(()=> { document.getElementById('status').innerText = STR[lang].ready; }, 2200);
      }
    });

    // append to chat window locally
    function addLocalMessage(text, me=false){
      const feed = document.getElementById('messageFeed');
      const d = document.createElement('div');
      d.className = 'msg' + (me ? ' me' : '');
      const b = document.createElement('div');
      b.className = 'bubble';
      b.innerText = text;
      d.appendChild(b);
      feed.appendChild(d);
      feed.scrollTop = feed.scrollHeight;
    }

    // support button placeholder
    function openSupport(){
      alert('For support, contact the site owner.');
    }

    // show admin id if available
    document.addEventListener('DOMContentLoaded', () => {
      if(window.__TELEGRAM__ && window.__TELEGRAM__.ADMIN) {
        document.getElementById('adminLabel').innerText = STR[lang].adminLabel + " " + window.__TELEGRAM__.ADMIN;
      }
    });

    // Helpful note for security
    // DO NOT put your real bot token into config.js unless you understand risk: the token will be public.
  </script>
</body>
</html>
